spring:
  application:
    name: gateway-service
  main:
    web-application-type: reactive
  # 禁用数据源
  datasource:
    enabled: false
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration
      - org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration
      - org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
      - org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration
      - com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration
      - io.seata.spring.boot.autoconfigure.SeataAutoConfiguration
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_HOST:8.133.246.113}:${NACOS_PORT:8848}
        namespace: ${NACOS_NAMESPACE:d750d92e-152f-4055-a641-3bc9dda85a29}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        # 禁用配置失败时导致应用启动失败
        fail-fast: false
        enabled: ${NACOS_DISCOVERY_ENABLED:true}
        # 增加连接超时设置
        timeout: 5000
        # 本地缓存配置
        naming-load-cache-at-start: true
        # 配置心跳间隔
        heart-beat-interval: 5000
        # 是否开启监听和订阅
        watch-delay: 30000
      config:
        server-addr: ${spring.cloud.nacos.discovery.server-addr}
        namespace: ${spring.cloud.nacos.discovery.namespace}
        group: ${spring.cloud.nacos.discovery.group}
        file-extension: yaml
        # 警告处理配置
        handle-warnings: true
        # 使配置失败时更友好的处理，不会导致应用启动失败
        fail-fast: false
        # 设置超时时间，防止长时间等待
        timeout: 10000
        refresh-enabled: true
        # 启用本地缓存配置
        enabled: ${NACOS_CONFIG_ENABLED:true}
        # 使用本地配置（即使连接失败也继续启动）
        import-check:
          enabled: false
        # 使用默认缓存目录，确保容器能正确访问
        shared-configs:
          - data-id: common-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}
            group: ${spring.cloud.nacos.discovery.group}
            refresh: true
            # 标记为可选的配置项
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

