# Spring Cloud Bootstrap配置
# 此文件在application.yml之前加载，用于配置配置中心、注册中心等

spring:
  application:
    name: messages-service
  config:
    import: optional:classpath:application-audit.yml,optional:classpath:application-seata.yml
  # 禁用SQL初始化，避免ddlApplicationRunner bean创建问题
  sql:
    init:
      mode: never
      continue-on-error: false
      platform: mysql
      encoding: UTF-8
      # 明确指定不加载任何SQL脚本
      schema-locations: []
      data-locations: []
      # 禁用自动检测
      detect-schema: false
      detect-data: false
  # 禁用JPA自动DDL
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    # 禁用自动DDL
    generate-ddl: false
    defer-datasource-initialization: false
  # 禁用Flyway和Liquibase
  flyway:
    enabled: false
  liquibase:
    enabled: false
  # 配置中心配置（Nacos）
  cloud:
    nacos:
      config:
        # Nacos配置中心地址
        server-addr: ${NACOS_SERVER_ADDR:8.133.246.113:8848}
        # 配置文件的data-id
        name: ${spring.application.name}
        # 配置文件格式
        file-extension: yaml
        # 配置分组
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        # 命名空间
        namespace: ${NACOS_NAMESPACE:d750d92e-152f-4055-a641-3bc9dda85a29}
        # 是否自动刷新
        refresh-enabled: true
        # 配置超时时间
        timeout: 3000
        # 配置重试次数
        retry-count: 3
        # 长轮询超时时间
        long-poll-timeout: 46000
        # 配置监听器长轮询超时时间
        config-long-poll-timeout: 46000
        # 配置重试时间
        config-retry-time: 20000
        # 是否启用配置监听
        enable-remote-sync-config: true
      
      # 注册中心配置（Nacos）
      discovery:
        # Nacos注册中心地址
        server-addr: ${NACOS_SERVER_ADDR:8.133.246.113:8848}
        # 服务分组
        group: ${NACOS_DISCOVERY_GROUP:JIANGYANG}
        # 命名空间
        namespace: ${NACOS_NAMESPACE:}
        # 是否启用服务注册
        enabled: true
        # 是否启用服务发现
        register-enabled: true
        # 服务实例权重
        weight: 1
        # 是否启用健康检查
        health-check-enabled: true
        # 健康检查超时时间
        health-check-timeout: 3000
        # 健康检查间隔时间
        health-check-interval: 10000
        # 心跳间隔时间
        heart-beat-interval: 5000
        # 心跳超时时间
        heart-beat-timeout: 15000
        # 实例IP删除超时时间
        ip-delete-timeout: 30000
        # 实例心跳超时时间
        instance-heart-beat-timeout: 15000
        # 实例心跳间隔时间
        instance-heart-beat-interval: 5000
        # 实例IP删除超时时间
        instance-ip-delete-timeout: 30000

# MyBatis-Plus配置
mybatis-plus:
  # 禁用DDL功能
  global-config:
    db-config:
      # 禁用逻辑删除
      logic-delete-field: ""
      # 禁用自动填充
      meta-object-handler: ""
    # 禁用Banner
    banner: false
  # 禁用SQL执行器
  configuration:
    # 禁用SQL执行器
    default-executor-type: SIMPLE
    # 禁用缓存
    cache-enabled: false
    # 禁用延迟加载
    lazy-loading-enabled: false
    # 禁用激进延迟加载
    aggressive-lazy-loading: false
  # 禁用DDL执行器
  ddl:
    enabled: false

# Seata 最小必需配置，避免依赖 application-dev.yml
seata:
  # 事务组名称
  tx-service-group: messages-service-group
  service:
    # vgroup映射
    vgroup-mapping:
      messages-service-group: default
    # Seata Server 列表（default 集群名 -> 地址）
    grouplist:
      default: 8.133.246.113:8091

# 消息服务配置
message:
  service:
    # 默认消息服务类型
    type: rocketmq
    # RocketMQ配置
    rocketmq:
      enabled: true
      name-server: 8.133.246.113:9876
      producer-group: jiangyang-dev-producer-group
      consumer-group: jiangyang-dev-consumer-group
      retry-sync-times: 3
      retry-async-times: 3
      send-msg-timeout: 3000
    # Kafka配置
    kafka:
      enabled: true
      bootstrap-servers: 8.133.246.113:9092
      consumer-group-id: jiangyang-dev-consumer-group
      acks: all
      retries: 3
      batch-size: 16384
      linger-ms: 1
      buffer-memory: 33554432
    # RabbitMQ配置
    rabbitmq:
      enabled: true
      host: 8.133.246.113
      port: 5672
      username: guest
      password: guest
      virtual-host: /
      connection-timeout: 60000
      requested-heart-beat: 60
      automatic-recovery-enabled: true

# Dubbo配置
dubbo:
  application:
    name: ${spring.application.name}
    qos-enable: false
  protocol:
    name: dubbo
    port: -1
  registry:
    address: ${NACOS_SERVER_ADDR:8.133.246.113:8848}
    protocol: nacos
    group: ${NACOS_GROUP:DEFAULT_GROUP}
    namespace: ${NACOS_NAMESPACE:d750d92e-152f-4055-a641-3bc9dda85a29}
  consumer:
    timeout: 5000
    retries: 2
    check: false
  provider:
    timeout: 5000
    retries: 2



