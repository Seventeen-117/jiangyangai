-- 消息Saga日志表
-- 用于记录Saga事务的执行日志和状态
CREATE TABLE IF NOT EXISTS `message_saga_log` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `business_id` varchar(128) DEFAULT NULL COMMENT '业务ID (消息ID、批次ID、事务ID等)',
  `operation` varchar(32) DEFAULT NULL COMMENT '操作类型 (SEND, CONFIRM, RECEIVE, BUSINESS_PROCESS, etc.)',
  `status` varchar(16) DEFAULT NULL COMMENT '操作状态 (PROCESSING, SUCCESS, FAILED, COMPENSATED)',
  `global_transaction_id` varchar(128) DEFAULT NULL COMMENT '全局事务ID (Seata XID)',
  `branch_transaction_id` varchar(128) DEFAULT NULL COMMENT '分支事务ID',
  `start_time` datetime DEFAULT NULL COMMENT '操作开始时间',
  `end_time` datetime DEFAULT NULL COMMENT '操作结束时间',
  `processing_time` bigint(20) DEFAULT NULL COMMENT '处理耗时 (毫秒)',
  `error_message` text COMMENT '错误信息',
  `error_stack_trace` text COMMENT '错误堆栈',
  `request_params` text COMMENT '请求参数 (JSON格式)',
  `response_result` text COMMENT '响应结果 (JSON格式)',
  `compensate_status` int(11) DEFAULT '0' COMMENT '补偿状态 (0-未补偿, 1-已补偿, 2-补偿失败)',
  `compensate_time` datetime DEFAULT NULL COMMENT '补偿时间',
  `compensate_count` int(11) DEFAULT '0' COMMENT '补偿次数',
  `max_compensate_count` int(11) DEFAULT '16' COMMENT '最大补偿次数',
  `retry_count` int(11) DEFAULT '0' COMMENT '重试次数',
  `max_retry_count` int(11) DEFAULT '16' COMMENT '最大重试次数',
  `business_context` text COMMENT '业务上下文 (JSON格式)',
  `extended_fields` text COMMENT '扩展字段 (JSON格式)',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `create_by` varchar(64) DEFAULT NULL COMMENT '创建人',
  `update_by` varchar(64) DEFAULT NULL COMMENT '更新人',
  `deleted` int(11) DEFAULT '0' COMMENT '逻辑删除标识 (0-未删除, 1-已删除)',
  PRIMARY KEY (`id`),
  KEY `idx_business_id` (`business_id`),
  KEY `idx_global_transaction_id` (`global_transaction_id`),
  KEY `idx_operation` (`operation`),
  KEY `idx_status` (`status`),
  KEY `idx_start_time` (`start_time`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_deleted` (`deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息Saga日志表';
