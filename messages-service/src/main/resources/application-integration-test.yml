# 集成测试配置文件
spring:
  profiles:
    active: integration-test
  
  # 数据源配置
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password: 
    
  # JPA配置
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true

# Kafka测试配置
kafka:
  # 使用测试环境的Kafka服务器
  bootstrap-servers:
    servers: localhost:9092
  
  # 消费者测试配置
  consumer:
    group-id: test-consumer-group
    enable-auto-commit: false  # 测试时禁用自动提交
    auto-commit-interval: 1000
    session-timeout: 10000     # 测试时使用较短的超时时间
    heartbeat-interval: 3000
    request-timeout: 15000
    retry-backoff: 500
    max-poll-interval: 60000
    max-poll-records: 10       # 测试时使用较小的批量大小
    partition-assignment-strategy: org.apache.kafka.clients.consumer.RangeAssignor
    key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
  
  # 生产者测试配置
  producer:
    bootstrap-servers: localhost:9092
    key-serializer: org.apache.kafka.common.serialization.StringSerializer
    value-serializer: org.apache.kafka.common.serialization.StringSerializer
    acks: 1                    # 测试时使用较低的可靠性
    retries: 1
    batch-size: 16384
    linger-ms: 0               # 测试时禁用批处理延迟
    buffer-memory: 33554432
  
  # 测试主题配置
  topics:
    default: test-topic
    dlq: test-dlq-topic
    retry: test-retry-topic
  
  # 测试消费配置
  consume:
    default-mode: PUSH
    default-type: CLUSTERING
    default-order: CONCURRENT
    default-batch-size: 10
    default-max-retry: 2
    default-timeout: 10000

# 日志配置
logging:
  level:
    com.jiangyang.messages: DEBUG
    org.apache.kafka: INFO
    org.springframework.kafka: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 测试配置
test:
  kafka:
    # 测试用的Kafka服务器地址
    bootstrap-servers: localhost:9092
    # 测试主题前缀
    topic-prefix: test-
    # 测试消费组前缀
    group-prefix: test-group-
    # 测试超时时间
    timeout: 10000
    # 测试重试次数
    max-retries: 3
