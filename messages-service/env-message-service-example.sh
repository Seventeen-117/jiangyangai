#!/bin/bash

# 消息服务统一环境变量配置示例
# 将此文件复制为 .env 文件，并根据实际环境修改配置值

# ========== 通用消息服务配置 ==========
export MESSAGE_SERVICE_DEFAULT_TYPE=rocketmq
export MESSAGE_SERVICE_SEND_ASYNC_ENABLED=true
export MESSAGE_SERVICE_SEND_MAX_RETRIES=3
export MESSAGE_SERVICE_SEND_RETRY_INTERVAL=1000
export MESSAGE_SERVICE_SEND_CONFIRM_ENABLED=true
export MESSAGE_SERVICE_SEND_CONFIRM_TIMEOUT=5000

export MESSAGE_SERVICE_CONSUME_DEFAULT_MODE=PUSH
export MESSAGE_SERVICE_CONSUME_DEFAULT_TYPE=CLUSTERING
export MESSAGE_SERVICE_CONSUME_DEFAULT_ORDER=CONCURRENT
export MESSAGE_SERVICE_CONSUME_MAX_CONCURRENCY=10
export MESSAGE_SERVICE_CONSUME_BATCH_SIZE=100
export MESSAGE_SERVICE_CONSUME_TIMEOUT=30000

export MESSAGE_SERVICE_RETRY_ENABLED=true
export MESSAGE_SERVICE_RETRY_MAX_RETRIES=3
export MESSAGE_SERVICE_RETRY_INTERVAL=1000
export MESSAGE_SERVICE_RETRY_BACKOFF_STRATEGY=EXPONENTIAL
export MESSAGE_SERVICE_RETRY_BACKOFF_MULTIPLIER=2.0
export MESSAGE_SERVICE_RETRY_MAX_RETRY_INTERVAL=60000

export MESSAGE_SERVICE_MONITORING_ENABLED=true
export MESSAGE_SERVICE_MONITORING_INTERVAL=30
export MESSAGE_SERVICE_MONITORING_VERBOSE_LOGGING=false
export MESSAGE_SERVICE_MONITORING_METRICS_BACKEND=prometheus

# ========== Kafka配置 ==========
export KAFKA_BOOTSTRAP_SERVERS=localhost:9092
export KAFKA_SECURITY_PROTOCOL=PLAINTEXT
export KAFKA_SASL_MECHANISM=PLAIN
export KAFKA_SASL_USERNAME=
export KAFKA_SASL_PASSWORD=

export KAFKA_CONSUMER_GROUP_ID=default-consumer-group
export KAFKA_CONSUMER_CLIENT_ID=default-consumer-client
export KAFKA_CONSUMER_ENABLE_AUTO_COMMIT=false
export KAFKA_CONSUMER_AUTO_COMMIT_INTERVAL=1000
export KAFKA_CONSUMER_SESSION_TIMEOUT=30000
export KAFKA_CONSUMER_HEARTBEAT_INTERVAL=10000
export KAFKA_CONSUMER_REQUEST_TIMEOUT=40000
export KAFKA_CONSUMER_MAX_POLL_RECORDS=500
export KAFKA_CONSUMER_MAX_POLL_BYTES=52428800
export KAFKA_CONSUMER_AUTO_OFFSET_RESET=latest
export KAFKA_CONSUMER_BATCH_SIZE=100
export KAFKA_CONSUMER_BATCH_THREAD_POOL_SIZE=4
export KAFKA_CONSUMER_ORDER_THREAD_COUNT=1
export KAFKA_CONSUMER_MAX_RETRIES=3
export KAFKA_CONSUMER_RETRYABLE_EXCEPTIONS=org.apache.kafka.common.errors.RetriableException,java.net.SocketTimeoutException,java.net.ConnectException

export KAFKA_PRODUCER_BOOTSTRAP_SERVERS=localhost:9092
export KAFKA_PRODUCER_ACKS=all
export KAFKA_PRODUCER_RETRIES=3
export KAFKA_PRODUCER_BATCH_SIZE=16384
export KAFKA_PRODUCER_LINGER_MS=1
export KAFKA_PRODUCER_BUFFER_MEMORY=33554432

export KAFKA_TOPICS_DEFAULT=default-topic
export KAFKA_TOPICS_DLQ=dlq-topic
export KAFKA_TOPICS_RETRY=retry-topic

# ========== RabbitMQ配置 ==========
export RABBITMQ_HOST=localhost
export RABBITMQ_PORT=5672
export RABBITMQ_USERNAME=guest
export RABBITMQ_PASSWORD=guest
export RABBITMQ_VIRTUAL_HOST=/

export RABBITMQ_CONNECTION_TIMEOUT=30000
export RABBITMQ_CONNECTION_HEARTBEAT=60
export RABBITMQ_CONNECTION_AUTOMATIC_RECOVERY=true
export RABBITMQ_CONNECTION_NETWORK_RECOVERY_INTERVAL=5000

export RABBITMQ_CONSUMER_DEFAULT_MODE=PUSH
export RABBITMQ_CONSUMER_DEFAULT_ACK_MODE=MANUAL
export RABBITMQ_CONSUMER_PREFETCH_COUNT=1
export RABBITMQ_CONSUMER_BATCH_SIZE=100
export RABBITMQ_CONSUMER_MAX_RETRY_TIMES=3
export RABBITMQ_CONSUMER_TIMEOUT=30000

export RABBITMQ_PRODUCER_CONFIRM_MODE=CORRELATED
export RABBITMQ_PRODUCER_RETURN_MODE=BASIC
export RABBITMQ_PRODUCER_BATCH_SIZE=100
export RABBITMQ_PRODUCER_TIMEOUT=5000

export RABBITMQ_QUEUE_DEFAULT_TYPE=CLASSIC
export RABBITMQ_QUEUE_DURABLE=true
export RABBITMQ_QUEUE_EXCLUSIVE=false
export RABBITMQ_QUEUE_AUTO_DELETE=false
export RABBITMQ_QUEUE_MAX_PRIORITY=10
export RABBITMQ_QUEUE_MAX_LENGTH=10000
export RABBITMQ_QUEUE_MESSAGE_TTL=86400000

export RABBITMQ_EXCHANGE_DEFAULT_TYPE=DIRECT
export RABBITMQ_EXCHANGE_DURABLE=true
export RABBITMQ_EXCHANGE_AUTO_DELETE=false
export RABBITMQ_EXCHANGE_INTERNAL=false

export RABBITMQ_DEAD_LETTER_ENABLED=true
export RABBITMQ_DEAD_LETTER_EXCHANGE_PREFIX=dlx.
export RABBITMQ_DEAD_LETTER_ROUTING_KEY_PREFIX=dlq.
export RABBITMQ_DEAD_LETTER_QUEUE_PREFIX=dlq.

export RABBITMQ_DELAY_ENABLED=true
export RABBITMQ_DELAY_EXCHANGE_PREFIX=delay.
export RABBITMQ_DELAY_QUEUE_PREFIX=delay.
export RABBITMQ_DELAY_DEFAULT_TTL=30000

export RABBITMQ_PRIORITY_ENABLED=true
export RABBITMQ_PRIORITY_MAX_PRIORITY=10
export RABBITMQ_PRIORITY_DEFAULT_PRIORITY=5

export RABBITMQ_CLUSTER_ENABLED=false
export RABBITMQ_CLUSTER_NODES=node1:5672,node2:5672,node3:5672
export RABBITMQ_CLUSTER_LOAD_BALANCE=ROUND_ROBIN

export RABBITMQ_MONITORING_ENABLED=true
export RABBITMQ_MONITORING_INTERVAL=30
export RABBITMQ_MONITORING_VERBOSE_LOGGING=false

# ========== RocketMQ配置 ==========
export ROCKETMQ_NAME_SERVER=localhost:9876
export ROCKETMQ_PRODUCER_GROUP=default-producer-group
export ROCKETMQ_CONSUMER_GROUP=default-consumer-group

export ROCKETMQ_PRODUCER_SEND_MSG_TIMEOUT=3000
export ROCKETMQ_PRODUCER_RETRY_TIMES_WHEN_SEND_FAILED=3
export ROCKETMQ_PRODUCER_RETRY_TIMES_WHEN_SEND_ASYNC_FAILED=3
export ROCKETMQ_PRODUCER_COMPRESS_MSG_BODY_OVER_HOWMUCH=4096
export ROCKETMQ_PRODUCER_MAX_MESSAGE_SIZE=4194304
export ROCKETMQ_PRODUCER_VIP_CHANNEL_ENABLED=false

export ROCKETMQ_CONSUMER_CONSUME_FROM_WHERE=CONSUME_FROM_LAST_OFFSET
export ROCKETMQ_CONSUMER_CONSUME_TIMEOUT=15
export ROCKETMQ_CONSUMER_PULL_BATCH_SIZE=32
export ROCKETMQ_CONSUMER_PULL_INTERVAL=0
export ROCKETMQ_CONSUMER_CONSUME_MESSAGE_BATCH_MAX_SIZE=1
export ROCKETMQ_CONSUMER_MAX_RECONSUME_TIMES=16

export ROCKETMQ_TRANSACTION_ENABLED=true
export ROCKETMQ_TRANSACTION_CHECK_THREAD_POOL_MIN_SIZE=1
export ROCKETMQ_TRANSACTION_CHECK_THREAD_POOL_MAX_SIZE=1
export ROCKETMQ_TRANSACTION_CHECK_REQUEST_HOLD_MAX=2000
export ROCKETMQ_TRANSACTION_CHECK_REQUEST_HOLD_MAX_VALUE=2000

# ========== 生产环境配置示例 ==========
# export MESSAGE_SERVICE_DEFAULT_TYPE=kafka
# export KAFKA_BOOTSTRAP_SERVERS=kafka-prod1:9092,kafka-prod2:9092,kafka-prod3:9092
# export RABBITMQ_HOST=rabbitmq-prod.example.com
# export ROCKETMQ_NAME_SERVER=rocketmq-prod1:9876,rocketmq-prod2:9876

# ========== 测试环境配置示例 ==========
# export MESSAGE_SERVICE_DEFAULT_TYPE=rabbitmq
# export KAFKA_BOOTSTRAP_SERVERS=kafka-test.example.com:9092
# export RABBITMQ_HOST=rabbitmq-test.example.com
# export ROCKETMQ_NAME_SERVER=rocketmq-test.example.com:9876

echo "消息服务环境变量配置已加载"
echo "当前配置："
echo "  默认消息服务类型: $MESSAGE_SERVICE_DEFAULT_TYPE"
echo "  Kafka服务器: $KAFKA_BOOTSTRAP_SERVERS"
echo "  RabbitMQ主机: $RABBITMQ_HOST"
echo "  RocketMQ NameServer: $ROCKETMQ_NAME_SERVER"
echo "  监控启用: $MESSAGE_SERVICE_MONITORING_ENABLED"
echo "  重试启用: $MESSAGE_SERVICE_RETRY_ENABLED"
